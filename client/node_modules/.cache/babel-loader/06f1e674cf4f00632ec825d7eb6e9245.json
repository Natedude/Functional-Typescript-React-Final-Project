{"ast":null,"code":"import { deletePassiveInputConnectionToAudioNode } from '../helpers/delete-passive-input-connection-to-audio-node';\nimport { setInternalStateToActive } from '../helpers/set-internal-state-to-active';\nimport { setInternalStateToPassiveWhenNecessary } from '../helpers/set-internal-state-to-passive-when-necessary';\nexport const createAddConnectionToAudioNode = (addActiveInputConnectionToAudioNode, addPassiveInputConnectionToAudioNode, connectNativeAudioNodeToNativeAudioNode, deleteActiveInputConnectionToAudioNode, disconnectNativeAudioNodeFromNativeAudioNode, getAudioNodeConnections, getAudioNodeTailTime, getEventListenersOfAudioNode, getNativeAudioNode, insertElementInSet, isActiveAudioNode, isPartOfACycle, isPassiveAudioNode) => {\n  const tailTimeTimeoutIds = new WeakMap();\n  return (source, destination, output, input, isOffline) => {\n    const {\n      activeInputs,\n      passiveInputs\n    } = getAudioNodeConnections(destination);\n    const {\n      outputs\n    } = getAudioNodeConnections(source);\n    const eventListeners = getEventListenersOfAudioNode(source);\n\n    const eventListener = isActive => {\n      const nativeDestinationAudioNode = getNativeAudioNode(destination);\n      const nativeSourceAudioNode = getNativeAudioNode(source);\n\n      if (isActive) {\n        const partialConnection = deletePassiveInputConnectionToAudioNode(passiveInputs, source, output, input);\n        addActiveInputConnectionToAudioNode(activeInputs, source, partialConnection, false);\n\n        if (!isOffline && !isPartOfACycle(source)) {\n          connectNativeAudioNodeToNativeAudioNode(nativeSourceAudioNode, nativeDestinationAudioNode, output, input);\n        }\n\n        if (isPassiveAudioNode(destination)) {\n          setInternalStateToActive(destination);\n        }\n      } else {\n        const partialConnection = deleteActiveInputConnectionToAudioNode(activeInputs, source, output, input);\n        addPassiveInputConnectionToAudioNode(passiveInputs, input, partialConnection, false);\n\n        if (!isOffline && !isPartOfACycle(source)) {\n          disconnectNativeAudioNodeFromNativeAudioNode(nativeSourceAudioNode, nativeDestinationAudioNode, output, input);\n        }\n\n        const tailTime = getAudioNodeTailTime(destination);\n\n        if (tailTime === 0) {\n          if (isActiveAudioNode(destination)) {\n            setInternalStateToPassiveWhenNecessary(destination, activeInputs);\n          }\n        } else {\n          const tailTimeTimeoutId = tailTimeTimeoutIds.get(destination);\n\n          if (tailTimeTimeoutId !== undefined) {\n            clearTimeout(tailTimeTimeoutId);\n          }\n\n          tailTimeTimeoutIds.set(destination, setTimeout(() => {\n            if (isActiveAudioNode(destination)) {\n              setInternalStateToPassiveWhenNecessary(destination, activeInputs);\n            }\n          }, tailTime * 1000));\n        }\n      }\n    };\n\n    if (insertElementInSet(outputs, [destination, output, input], outputConnection => outputConnection[0] === destination && outputConnection[1] === output && outputConnection[2] === input, true)) {\n      eventListeners.add(eventListener);\n\n      if (isActiveAudioNode(source)) {\n        addActiveInputConnectionToAudioNode(activeInputs, source, [output, input, eventListener], true);\n      } else {\n        addPassiveInputConnectionToAudioNode(passiveInputs, input, [source, output, eventListener], true);\n      }\n\n      return true;\n    }\n\n    return false;\n  };\n};","map":{"version":3,"sources":["../../../src/factories/add-connection-to-audio-node.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { deletePassiveInputConnectionToAudioNode } from '../helpers/delete-passive-input-connection-to-audio-node';\nimport { setInternalStateToActive } from '../helpers/set-internal-state-to-active';\nimport { setInternalStateToPassiveWhenNecessary } from '../helpers/set-internal-state-to-passive-when-necessary';\nexport const createAddConnectionToAudioNode = (addActiveInputConnectionToAudioNode, addPassiveInputConnectionToAudioNode, connectNativeAudioNodeToNativeAudioNode, deleteActiveInputConnectionToAudioNode, disconnectNativeAudioNodeFromNativeAudioNode, getAudioNodeConnections, getAudioNodeTailTime, getEventListenersOfAudioNode, getNativeAudioNode, insertElementInSet, isActiveAudioNode, isPartOfACycle, isPassiveAudioNode) => {\n    const tailTimeTimeoutIds = new WeakMap();\n    return (source, destination, output, input, isOffline) => {\n        const { activeInputs, passiveInputs } = getAudioNodeConnections(destination);\n        const { outputs } = getAudioNodeConnections(source);\n        const eventListeners = getEventListenersOfAudioNode(source);\n        const eventListener = (isActive) => {\n            const nativeDestinationAudioNode = getNativeAudioNode(destination);\n            const nativeSourceAudioNode = getNativeAudioNode(source);\n            if (isActive) {\n                const partialConnection = deletePassiveInputConnectionToAudioNode(passiveInputs, source, output, input);\n                addActiveInputConnectionToAudioNode(activeInputs, source, partialConnection, false);\n                if (!isOffline && !isPartOfACycle(source)) {\n                    connectNativeAudioNodeToNativeAudioNode(nativeSourceAudioNode, nativeDestinationAudioNode, output, input);\n                }\n                if (isPassiveAudioNode(destination)) {\n                    setInternalStateToActive(destination);\n                }\n            }\n            else {\n                const partialConnection = deleteActiveInputConnectionToAudioNode(activeInputs, source, output, input);\n                addPassiveInputConnectionToAudioNode(passiveInputs, input, partialConnection, false);\n                if (!isOffline && !isPartOfACycle(source)) {\n                    disconnectNativeAudioNodeFromNativeAudioNode(nativeSourceAudioNode, nativeDestinationAudioNode, output, input);\n                }\n                const tailTime = getAudioNodeTailTime(destination);\n                if (tailTime === 0) {\n                    if (isActiveAudioNode(destination)) {\n                        setInternalStateToPassiveWhenNecessary(destination, activeInputs);\n                    }\n                }\n                else {\n                    const tailTimeTimeoutId = tailTimeTimeoutIds.get(destination);\n                    if (tailTimeTimeoutId !== undefined) {\n                        clearTimeout(tailTimeTimeoutId);\n                    }\n                    tailTimeTimeoutIds.set(destination, setTimeout(() => {\n                        if (isActiveAudioNode(destination)) {\n                            setInternalStateToPassiveWhenNecessary(destination, activeInputs);\n                        }\n                    }, tailTime * 1000));\n                }\n            }\n        };\n        if (insertElementInSet(outputs, [destination, output, input], (outputConnection) => outputConnection[0] === destination && outputConnection[1] === output && outputConnection[2] === input, true)) {\n            eventListeners.add(eventListener);\n            if (isActiveAudioNode(source)) {\n                addActiveInputConnectionToAudioNode(activeInputs, source, [output, input, eventListener], true);\n            }\n            else {\n                addPassiveInputConnectionToAudioNode(passiveInputs, input, [source, output, eventListener], true);\n            }\n            return true;\n        }\n        return false;\n    };\n};\n//# sourceMappingURL=add-connection-to-audio-node.js.map"]},"metadata":{},"sourceType":"module"}