{"ast":null,"code":"import { ToneAudioNode } from \"../../core/context/ToneAudioNode\";\nimport { optionsFromArguments } from \"../../core/util/Defaults\";\nimport { Gain } from \"../../core/context/Gain\";\n/**\n * A one pole filter with 6db-per-octave rolloff. Either \"highpass\" or \"lowpass\".\n * Note that changing the type or frequency may result in a discontinuity which\n * can sound like a click or pop.\n * References:\n * * http://www.earlevel.com/main/2012/12/15/a-one-pole-filter/\n * * http://www.dspguide.com/ch19/2.htm\n * * https://github.com/vitaliy-bobrov/js-rocks/blob/master/src/app/audio/effects/one-pole-filters.ts\n * @category Component\n */\n\nexport class OnePoleFilter extends ToneAudioNode {\n  constructor() {\n    super(optionsFromArguments(OnePoleFilter.getDefaults(), arguments, [\"frequency\", \"type\"]));\n    this.name = \"OnePoleFilter\";\n    const options = optionsFromArguments(OnePoleFilter.getDefaults(), arguments, [\"frequency\", \"type\"]);\n    this._frequency = options.frequency;\n    this._type = options.type;\n    this.input = new Gain({\n      context: this.context\n    });\n    this.output = new Gain({\n      context: this.context\n    });\n\n    this._createFilter();\n  }\n\n  static getDefaults() {\n    return Object.assign(ToneAudioNode.getDefaults(), {\n      frequency: 880,\n      type: \"lowpass\"\n    });\n  }\n  /**\n   * Create a filter and dispose the old one\n   */\n\n\n  _createFilter() {\n    const oldFilter = this._filter;\n    const freq = this.toFrequency(this._frequency);\n    const t = 1 / (2 * Math.PI * freq);\n\n    if (this._type === \"lowpass\") {\n      const a0 = 1 / (t * this.context.sampleRate);\n      const b1 = a0 - 1;\n      this._filter = this.context.createIIRFilter([a0, 0], [1, b1]);\n    } else {\n      const b1 = 1 / (t * this.context.sampleRate) - 1;\n      this._filter = this.context.createIIRFilter([1, -1], [1, b1]);\n    }\n\n    this.input.chain(this._filter, this.output);\n\n    if (oldFilter) {\n      // dispose it on the next block\n      this.context.setTimeout(() => {\n        if (!this.disposed) {\n          this.input.disconnect(oldFilter);\n          oldFilter.disconnect();\n        }\n      }, this.blockTime);\n    }\n  }\n  /**\n   * The frequency value.\n   */\n\n\n  get frequency() {\n    return this._frequency;\n  }\n\n  set frequency(fq) {\n    this._frequency = fq;\n\n    this._createFilter();\n  }\n  /**\n   * The OnePole Filter type, either \"highpass\" or \"lowpass\"\n   */\n\n\n  get type() {\n    return this._type;\n  }\n\n  set type(t) {\n    this._type = t;\n\n    this._createFilter();\n  }\n  /**\n   * Get the frequency response curve. This curve represents how the filter\n   * responses to frequencies between 20hz-20khz.\n   * @param  len The number of values to return\n   * @return The frequency response curve between 20-20kHz\n   */\n\n\n  getFrequencyResponse(len = 128) {\n    const freqValues = new Float32Array(len);\n\n    for (let i = 0; i < len; i++) {\n      const norm = Math.pow(i / len, 2);\n      const freq = norm * (20000 - 20) + 20;\n      freqValues[i] = freq;\n    }\n\n    const magValues = new Float32Array(len);\n    const phaseValues = new Float32Array(len);\n\n    this._filter.getFrequencyResponse(freqValues, magValues, phaseValues);\n\n    return magValues;\n  }\n\n  dispose() {\n    super.dispose();\n    this.input.dispose();\n    this.output.dispose();\n\n    this._filter.disconnect();\n\n    return this;\n  }\n\n}","map":{"version":3,"sources":["../../../../Tone/component/filter/OnePoleFilter.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { ToneAudioNode } from \"../../core/context/ToneAudioNode\";\nimport { optionsFromArguments } from \"../../core/util/Defaults\";\nimport { Gain } from \"../../core/context/Gain\";\n/**\n * A one pole filter with 6db-per-octave rolloff. Either \"highpass\" or \"lowpass\".\n * Note that changing the type or frequency may result in a discontinuity which\n * can sound like a click or pop.\n * References:\n * * http://www.earlevel.com/main/2012/12/15/a-one-pole-filter/\n * * http://www.dspguide.com/ch19/2.htm\n * * https://github.com/vitaliy-bobrov/js-rocks/blob/master/src/app/audio/effects/one-pole-filters.ts\n * @category Component\n */\nexport class OnePoleFilter extends ToneAudioNode {\n    constructor() {\n        super(optionsFromArguments(OnePoleFilter.getDefaults(), arguments, [\"frequency\", \"type\"]));\n        this.name = \"OnePoleFilter\";\n        const options = optionsFromArguments(OnePoleFilter.getDefaults(), arguments, [\"frequency\", \"type\"]);\n        this._frequency = options.frequency;\n        this._type = options.type;\n        this.input = new Gain({ context: this.context });\n        this.output = new Gain({ context: this.context });\n        this._createFilter();\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            frequency: 880,\n            type: \"lowpass\"\n        });\n    }\n    /**\n     * Create a filter and dispose the old one\n     */\n    _createFilter() {\n        const oldFilter = this._filter;\n        const freq = this.toFrequency(this._frequency);\n        const t = 1 / (2 * Math.PI * freq);\n        if (this._type === \"lowpass\") {\n            const a0 = 1 / (t * this.context.sampleRate);\n            const b1 = a0 - 1;\n            this._filter = this.context.createIIRFilter([a0, 0], [1, b1]);\n        }\n        else {\n            const b1 = 1 / (t * this.context.sampleRate) - 1;\n            this._filter = this.context.createIIRFilter([1, -1], [1, b1]);\n        }\n        this.input.chain(this._filter, this.output);\n        if (oldFilter) {\n            // dispose it on the next block\n            this.context.setTimeout(() => {\n                if (!this.disposed) {\n                    this.input.disconnect(oldFilter);\n                    oldFilter.disconnect();\n                }\n            }, this.blockTime);\n        }\n    }\n    /**\n     * The frequency value.\n     */\n    get frequency() {\n        return this._frequency;\n    }\n    set frequency(fq) {\n        this._frequency = fq;\n        this._createFilter();\n    }\n    /**\n     * The OnePole Filter type, either \"highpass\" or \"lowpass\"\n     */\n    get type() {\n        return this._type;\n    }\n    set type(t) {\n        this._type = t;\n        this._createFilter();\n    }\n    /**\n     * Get the frequency response curve. This curve represents how the filter\n     * responses to frequencies between 20hz-20khz.\n     * @param  len The number of values to return\n     * @return The frequency response curve between 20-20kHz\n     */\n    getFrequencyResponse(len = 128) {\n        const freqValues = new Float32Array(len);\n        for (let i = 0; i < len; i++) {\n            const norm = Math.pow(i / len, 2);\n            const freq = norm * (20000 - 20) + 20;\n            freqValues[i] = freq;\n        }\n        const magValues = new Float32Array(len);\n        const phaseValues = new Float32Array(len);\n        this._filter.getFrequencyResponse(freqValues, magValues, phaseValues);\n        return magValues;\n    }\n    dispose() {\n        super.dispose();\n        this.input.dispose();\n        this.output.dispose();\n        this._filter.disconnect();\n        return this;\n    }\n}\n//# sourceMappingURL=OnePoleFilter.js.map"]},"metadata":{},"sourceType":"module"}