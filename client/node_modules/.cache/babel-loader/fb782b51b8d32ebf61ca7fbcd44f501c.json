{"ast":null,"code":"import { ToneAudioNode } from \"../context/ToneAudioNode\";\nimport { noOp } from \"../util/Interface\";\nimport { getWorkletGlobalScope } from \"./WorkletGlobalScope\";\nexport class ToneAudioWorklet extends ToneAudioNode {\n  constructor(options) {\n    super(options);\n    this.name = \"ToneAudioWorklet\";\n    /**\n     * The constructor options for the node\n     */\n\n    this.workletOptions = {};\n    /**\n     * Callback which is invoked when there is an error in the processing\n     */\n\n    this.onprocessorerror = noOp;\n    const blobUrl = URL.createObjectURL(new Blob([getWorkletGlobalScope()], {\n      type: \"text/javascript\"\n    }));\n\n    const name = this._audioWorkletName();\n\n    this._dummyGain = this.context.createGain();\n    this._dummyParam = this._dummyGain.gain; // Register the processor\n\n    this.context.addAudioWorkletModule(blobUrl, name).then(() => {\n      // create the worklet when it's read\n      if (!this.disposed) {\n        this._worklet = this.context.createAudioWorkletNode(name, this.workletOptions);\n        this._worklet.onprocessorerror = this.onprocessorerror.bind(this);\n        this.onReady(this._worklet);\n      }\n    });\n  }\n\n  dispose() {\n    super.dispose();\n\n    this._dummyGain.disconnect();\n\n    if (this._worklet) {\n      this._worklet.port.postMessage(\"dispose\");\n\n      this._worklet.disconnect();\n    }\n\n    return this;\n  }\n\n}","map":{"version":3,"sources":["../../../../Tone/core/worklet/ToneAudioWorklet.ts"],"names":[],"mappings":"AAAA,SAAS,aAAT,QAAoD,0BAApD;AACA,SAAS,IAAT,QAAqB,mBAArB;AACA,SAAS,qBAAT,QAAsC,sBAAtC;AAIA,OAAM,MAAgB,gBAAhB,SAAkF,aAAlF,CAAwG;AAuC7G,EAAA,WAAA,CAAY,OAAZ,EAA4B;AAC3B,UAAM,OAAN;AAtCQ,SAAA,IAAA,GAAe,kBAAf;AAiBT;;AAEG;;AACO,SAAA,cAAA,GAAmD,EAAnD;AAYV;;AAEG;;AACH,SAAA,gBAAA,GAAwC,IAAxC;AAKC,UAAM,OAAO,GAAG,GAAG,CAAC,eAAJ,CAAoB,IAAI,IAAJ,CAAS,CAAC,qBAAqB,EAAtB,CAAT,EAAoC;AAAE,MAAA,IAAI,EAAE;AAAR,KAApC,CAApB,CAAhB;;AACA,UAAM,IAAI,GAAG,KAAK,iBAAL,EAAb;;AAEA,SAAK,UAAL,GAAkB,KAAK,OAAL,CAAa,UAAb,EAAlB;AACA,SAAK,WAAL,GAAmB,KAAK,UAAL,CAAgB,IAAnC,CAP2B,CAS3B;;AACA,SAAK,OAAL,CAAa,qBAAb,CAAmC,OAAnC,EAA4C,IAA5C,EAAkD,IAAlD,CAAuD,MAAK;AAC3D;AACA,UAAI,CAAC,KAAK,QAAV,EAAoB;AACnB,aAAK,QAAL,GAAgB,KAAK,OAAL,CAAa,sBAAb,CAAoC,IAApC,EAA0C,KAAK,cAA/C,CAAhB;AACA,aAAK,QAAL,CAAc,gBAAd,GAAiC,KAAK,gBAAL,CAAsB,IAAtB,CAA2B,IAA3B,CAAjC;AACA,aAAK,OAAL,CAAa,KAAK,QAAlB;AACA;AACD,KAPD;AAQA;;AAED,EAAA,OAAO,GAAA;AACN,UAAM,OAAN;;AACA,SAAK,UAAL,CAAgB,UAAhB;;AACA,QAAI,KAAK,QAAT,EAAmB;AAClB,WAAK,QAAL,CAAc,IAAd,CAAmB,WAAnB,CAA+B,SAA/B;;AACA,WAAK,QAAL,CAAc,UAAd;AACA;;AACD,WAAO,IAAP;AACA;;AAnE4G","sourceRoot":"","sourcesContent":["import { ToneAudioNode } from \"../context/ToneAudioNode\";\nimport { noOp } from \"../util/Interface\";\nimport { getWorkletGlobalScope } from \"./WorkletGlobalScope\";\nexport class ToneAudioWorklet extends ToneAudioNode {\n    constructor(options) {\n        super(options);\n        this.name = \"ToneAudioWorklet\";\n        /**\n         * The constructor options for the node\n         */\n        this.workletOptions = {};\n        /**\n         * Callback which is invoked when there is an error in the processing\n         */\n        this.onprocessorerror = noOp;\n        const blobUrl = URL.createObjectURL(new Blob([getWorkletGlobalScope()], { type: \"text/javascript\" }));\n        const name = this._audioWorkletName();\n        this._dummyGain = this.context.createGain();\n        this._dummyParam = this._dummyGain.gain;\n        // Register the processor\n        this.context.addAudioWorkletModule(blobUrl, name).then(() => {\n            // create the worklet when it's read\n            if (!this.disposed) {\n                this._worklet = this.context.createAudioWorkletNode(name, this.workletOptions);\n                this._worklet.onprocessorerror = this.onprocessorerror.bind(this);\n                this.onReady(this._worklet);\n            }\n        });\n    }\n    dispose() {\n        super.dispose();\n        this._dummyGain.disconnect();\n        if (this._worklet) {\n            this._worklet.port.postMessage(\"dispose\");\n            this._worklet.disconnect();\n        }\n        return this;\n    }\n}\n//# sourceMappingURL=ToneAudioWorklet.js.map"]},"metadata":{},"sourceType":"module"}